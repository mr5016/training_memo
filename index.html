<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Planner â€“ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆ (æ•°å¼è‡ªå‹•ç”Ÿæˆ)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { padding-top: 3rem; }
    #planDisplay .card-header { background:#f5f5f5; }
  </style>
</head>
<body class="bg-light">
<div class="container">
  <h1 class="mb-4">ğŸ‹ï¸â€â™‚ï¸ Workout Planner â€“ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç‰ˆ</h1>
  <!-- LIFT & DAY INPUT -->
  <div id="liftCard" class="card mb-4">
    <div class="card-header">1ï¸âƒ£ å‰å›ã®å®Ÿç¸¾ & æ›œæ—¥ã‚’å…¥åŠ›</div>
    <div class="card-body">
      <div class="mb-3">
        <label class="fw-bold">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ›œæ—¥ã‚’é¸æŠ (è¤‡æ•°å¯)</label>
        <div class="d-flex flex-wrap gap-3" id="daySelect">
          <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="chkMon"><label class="form-check-label" for="chkMon">æœˆ</label></div>
          <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="chkTue"><label class="form-check-label" for="chkTue">ç«</label></div>
          <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="chkWed"><label class="form-check-label" for="chkWed">æ°´</label></div>
          <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="chkThu"><label class="form-check-label" for="chkThu">æœ¨</label></div>
          <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="chkFri"><label class="form-check-label" for="chkFri">é‡‘</label></div>
          <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="chkSat"><label class="form-check-label" for="chkSat">åœŸ</label></div>
          <div class="form-check form-check-inline"><input class="form-check-input" type="checkbox" id="chkSun"><label class="form-check-label" for="chkSun">æ—¥</label></div>
        </div>
      </div>
      <div class="row g-4">
        <script>
          function buildTable(prefix,title){
            document.write(`<div class='col-md-4'><h5 class='fw-bold text-center'>${title}</h5><table class='table table-sm'><thead><tr><th>é‡é‡ kg</th><th>å›æ•°</th></tr></thead><tbody>`);
            for(let i=1;i<=5;i++){
              document.write(`<tr><td><input id='${prefix}W${i}' type='number' class='form-control' step='0.5' min='0'></td><td><input id='${prefix}R${i}' type='number' class='form-control' step='1' min='1'></td></tr>`);
            }
            document.write(`</tbody></table></div>`);
          }
          buildTable('bench','ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹');
          buildTable('db','ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹');
          buildTable('fly','ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤');
        </script>
      </div>
      <button id="generateBtn" class="btn btn-success mt-3">ğŸ’¡ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”Ÿæˆ</button>
    </div>
  </div>
  <!-- PLAN OUTPUT -->
  <div id="planArea" class="card d-none">
    <div class="card-header">2ï¸âƒ£ ç”Ÿæˆã•ã‚ŒãŸ 1 é€±é–“ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <div class="card-body" id="planDisplay"></div>
  </div>
</div>
<script>
// === å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ (RPE â†’ %1RM ãƒ†ãƒ¼ãƒ–ãƒ«)
const RPE_CHART_URL = 'https://raw.githubusercontent.com/openai-examples/rpe-chart/main/rpe_chart.json';

// === UI helper ===
const toggle = (id, show) => document.getElementById(id).classList.toggle('d-none', !show);

// === ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•° ===
const collectSets = p => {
  const arr = [];
  for (let i = 1; i <= 5; i++) {
    const w = parseFloat(document.getElementById(p + 'W' + i).value);
    const r = parseInt(document.getElementById(p + 'R' + i).value);
    if (!isNaN(w) && !isNaN(r)) arr.push({ w, r });
  }
  return arr;
};

const collectDays = () =>
  [['Mon', 'æœˆ'], ['Tue', 'ç«'], ['Wed', 'æ°´'], ['Thu', 'æœ¨'], ['Fri', 'é‡‘'], ['Sat', 'åœŸ'], ['Sun', 'æ—¥']]
    .filter(([id]) => document.getElementById('chk' + id).checked)
    .map(a => a[1]);

// === æ•°å¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===
const estimate1RM = (w, r) => w * (1 + r / 30); // Epley å…¬å¼
const roundToHalf = v => Math.round(v * 2) / 2; // 0.5kg åˆ»ã¿

// === å¤–éƒ¨ã‚µã‚¤ãƒˆã‹ã‚‰ RPE ãƒ†ãƒ¼ãƒ–ãƒ«å–å¾— ===
async function fetchRPEChart() {
  try {
    const res = await fetch(RPE_CHART_URL);
    if (!res.ok) throw new Error('fetch error');
    return await res.json();
  } catch (e) {
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ (ä»£è¡¨å€¤)
    return {
      "3": { "7": 0.88, "7.5": 0.89, "8": 0.91, "8.5": 0.93, "9": 0.95 },
      "4": { "7": 0.85, "7.5": 0.87, "8": 0.88, "8.5": 0.90, "9": 0.92 },
      "5": { "7": 0.82, "7.5": 0.84, "8": 0.86, "8.5": 0.88, "9": 0.90 },
      "6": { "7": 0.79, "7.5": 0.81, "8": 0.83, "8.5": 0.85, "9": 0.87 },
      "8": { "7": 0.72, "7.5": 0.74, "8": 0.76, "8.5": 0.78, "9": 0.80 }
    };
  }
}

// === ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ===
function renderPlan(obj) {
  const area = document.getElementById('planDisplay');
  area.innerHTML = '';
  Object.keys(obj).forEach(day => {
    const card = document.createElement('div');
    card.className = 'card mb-3';
    card.innerHTML = `<div class='card-header fw-bold'>${day}</div>`;
    const list = document.createElement('ul');
    list.className = 'list-group list-group-flush';
    for (const ex in obj[day]) {
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.innerHTML = `<strong>${ex}</strong>: ${obj[day][ex].join(', ')}`;
      list.appendChild(li);
    }
    card.appendChild(list);
    area.appendChild(card);
  });
}

// === ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”Ÿæˆãƒ¡ã‚¤ãƒ³ ===
async function generatePlan() {
  toggle('planArea', false);
  const days = collectDays();
  if (!days.length) { alert('æ›œæ—¥ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„'); return; }

  const exercises = {
    'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹': collectSets('bench'),
    'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹': collectSets('db'),
    'ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤': collectSets('fly')
  };

  if (Object.values(exercises).every(arr => arr.length === 0)) {
    alert('æœ€ä½1ç¨®ç›®ã®å®Ÿç¸¾ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  const rpeChart = await fetchRPEChart();

  const plan = {};
  days.forEach((day, dIdx) => {
    const title = `Day ${dIdx + 1}ï¼ˆ${day}ï¼‰`;
    plan[title] = {};
    Object.entries(exercises).forEach(([name, sets]) => {
      if (!sets.length) return; // æœªå…¥åŠ›ç¨®ç›®ã¯ã‚¹ã‚­ãƒƒãƒ—
      const best = sets.reduce((m, s) => (s.w > m.w ? s : m), sets[0]);
      const est1RM = estimate1RM(best.w, best.r);
      const repScheme = [8, 6, 5, 4, 3];
      const setArr = repScheme.map((rep, i) => {
        const rpe = (7 + i * 0.5).toFixed(1); // 7, 7.5, 8, 8.5, 9
        let pct = rpeChart?.[rep]?.[rpe];
        if (!pct) pct = 0.70 + i * 0.04; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        pct += dIdx * 0.02; // æ›œæ—¥ãŒå¾Œã‚ã»ã© +2% é‡ã
        const weight = roundToHalf(est1RM * pct);
        return `${weight}kg x ${rep}`;
      });
      plan[title][name] = setArr;
    });
  });

  renderPlan(plan);
  toggle('planArea', true);
}

// === ã‚¤ãƒ™ãƒ³ãƒˆ ===
Document.addEventListener ? document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('generateBtn').addEventListener('click', generatePlan);
}) : window.onload = () => {
  document.getElementById('generateBtn').addEventListener('click', generatePlan);
};
</script>
</body>
</html>
