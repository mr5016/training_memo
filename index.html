<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Planner â€“ é€±æ¬¡ä¿å­˜ & 1æ—¥å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    body{padding-top:3rem}
    #planDisplay .card-header{background:#f5f5f5}
    .exercise-section{border:1px solid #dee2e6;border-radius:.5rem;padding:1rem;margin-bottom:1.5rem}
    .today-row{background:#fff3cd;border-radius:.25rem;padding:.1rem .4rem}
    .editing-row{background:#cff4fc}
  </style>
</head>
<body class="bg-light">
<div class="container">
  <!-- Navigation -->
  <nav class="mb-3">
    <ul class="nav nav-pills">
      <li class="nav-item"><a class="nav-link active" href="#" id="linkPlanner">ãƒ—ãƒ©ãƒ³ä½œæˆ</a></li>
      <li class="nav-item"><a class="nav-link" href="#" id="linkStats">çµ±è¨ˆ</a></li>
    </ul>
  </nav>

  <!-- ================= PAGE : PLANNER ================= -->
  <div id="pagePlanner">
    <h1 class="mb-4">ğŸ‹ï¸â€â™‚ï¸ Workout Planner â€“ é€±æ¬¡ä¿å­˜ & 1æ—¥å…¥åŠ›</h1>

    <!-- DAY CATEGORY SELECT -->
    <div id="dayCatCard" class="card mb-4">
      <div class="card-header">1ï¸âƒ£ ä»Šé€±ã®å„æ›œæ—¥ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã€å…¥åŠ›ã™ã‚‹æ›œæ—¥ã‚’ã‚¯ãƒªãƒƒã‚¯ <small class="text-muted ms-2">(â­=ä»Šæ—¥)</small></div>
      <div class="card-body" id="daySelect"></div>
    </div>

    <!-- INPUT AREA (singleâ€‘day) -->
    <div id="liftCard" class="card mb-4 d-none">
      <div class="card-header">2ï¸âƒ£ <span id="editDayLabel"></span> ã®å®Ÿç¸¾ã‚’å…¥åŠ›</div>
      <div class="card-body">
        <!-- Chest -->
        <div class="exercise-section d-none" id="secWrapChest"><h4 class="fw-bold mb-3">èƒ¸ (Chest)</h4><div class="row g-4" id="secChest"></div></div>
        <!-- Legs -->
        <div class="exercise-section d-none" id="secWrapLegs"><h4 class="fw-bold mb-3">è¶³ (Legs)</h4><div class="row g-4" id="secLegs"></div></div>
        <!-- Arms -->
        <div class="exercise-section d-none" id="secWrapArms"><h4 class="fw-bold mb-3">è…• (Arms)</h4><div class="row g-4" id="secArms"></div></div>
        <!-- Back -->
        <div class="exercise-section d-none" id="secWrapBack"><h4 class="fw-bold mb-3">èƒŒä¸­ (Back)</h4><div class="row g-4" id="secBack"></div></div>
        <button id="saveDayBtn" class="btn btn-primary mt-2">ğŸ’¾ ã“ã®æ—¥ã®å®Ÿç¸¾ã‚’ä¿å­˜</button>
      </div>
    </div>

    <!-- PLAN OUTPUT -->
    <div id="planArea" class="card d-none">
      <div class="card-header">3ï¸âƒ£ ç”Ÿæˆã•ã‚ŒãŸ 1 é€±é–“ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
      <div class="card-body" id="planDisplay"></div>
    </div>
  </div>

  <!-- ================= PAGE : STATS ================= -->
  <div id="pageStats" class="d-none">
    <h2 class="mb-3">ğŸ“ˆ é€²æ—ã‚°ãƒ©ãƒ• <span id="statsCatLabel" class="badge bg-secondary"></span></h2>
    <div class="card mb-4"><div class="card-body"><canvas id="statsChart" height="280"></canvas></div><div class="card-footer d-flex justify-content-between"><button class="btn btn-outline-secondary btn-sm" id="prevCatBtn">â—€ Previous</button><button class="btn btn-outline-secondary btn-sm" id="nextCatBtn">Next â–¶</button></div></div>
    <button class="btn btn-primary" id="backToPlanner">â† ãƒ—ãƒ©ãƒ³ã¸æˆ»ã‚‹</button>
  </div>
</div>

<script>
// ====== Constants / Config ======
const DAYS=[{id:'Mon',jp:'æœˆ',num:1},{id:'Tue',jp:'ç«',num:2},{id:'Wed',jp:'æ°´',num:3},{id:'Thu',jp:'æœ¨',num:4},{id:'Fri',jp:'é‡‘',num:5},{id:'Sat',jp:'åœŸ',num:6},{id:'Sun',jp:'æ—¥',num:0}];
const CATEGORY_EXERCISES={
  chest:[{prefix:'bench',name:'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹'},{prefix:'db',name:'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹'},{prefix:'fly',name:'ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤'}],
  legs:[{prefix:'sq',name:'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ'},{prefix:'lc',name:'ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«'},{prefix:'le',name:'ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³'},{prefix:'lp',name:'ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹'}],
  arms:[{prefix:'ez',name:'EZãƒãƒ¼ã‚«ãƒ¼ãƒ«'},{prefix:'inc',name:'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ã‚«ãƒ¼ãƒ«'},{prefix:'lie',name:'ãƒ©ã‚¤ã‚¤ãƒ³ã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³'},{prefix:'pd',name:'ãƒ—ãƒ¬ã‚¹ãƒ€ã‚¦ãƒ³'}],
  back:[{prefix:'chin',name:'ãƒãƒ³ãƒ‹ãƒ³ã‚°'},{prefix:'dl',name:'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ'},{prefix:'bor',name:'ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼'},{prefix:'dbr',name:'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ­ãƒ¼'}]
};
const STORAGE_KEY_PLAN='wkPlannerWeekV1'; // weekâ€‘scoped
const STORAGE_KEY_HIST='wkPlannerHistoryV1';
const CATS=['chest','arms','legs','back'];
// ====== State ======
let editingDayIdx=null; // 0â€‘6
let chartInstance=null;
// ====== Helper ======
const round05=v=>Math.round(v*2)/2;
const estimate1RM=(w,r)=>w*(1+r/30);
const capitalize=s=>s.charAt(0).toUpperCase()+s.slice(1);
const getWeekStart=()=>{const d=new Date();const day=d.getDay();const diff=d.getDate()-day+(day===0?-6:1);const mon=new Date(d.setDate(diff));mon.setHours(0,0,0,0);return mon.toISOString().slice(0,10);};// yyyyâ€‘mmâ€‘dd
const currentWeek=getWeekStart();
// ====== Build Exercise Tables ======
function buildTable(containerId,prefix,title){const c=document.getElementById(containerId);const col=document.createElement('div');col.className='col-md-4';col.innerHTML=`<h5 class='fw-bold text-center'>${title}</h5><table class='table table-sm'><thead><tr><th>é‡é‡ kg</th><th>å›æ•°</th></tr></thead><tbody>${Array.from({length:5}).map((_,i)=>`<tr><td><input id='${prefix}W${i+1}' type='number' class='form-control' step='0.5' min='0'></td><td><input id='${prefix}R${i+1}' type='number' class='form-control' step='1' min='1'></td></tr>`).join('')}</tbody></table>`;c.appendChild(col);} // end buildTable
(function buildAllTables(){Object.entries(CATEGORY_EXERCISES).forEach(([cat,arr])=>{const containerId={chest:'secChest',legs:'secLegs',arms:'secArms',back:'secBack'}[cat];arr.forEach(ex=>buildTable(containerId,ex.prefix,ex.name));});})();
// ====== Day Selector UI ======
(function buildDayRows(){const wrap=document.getElementById('daySelect');const todayNum=new Date().getDay();DAYS.forEach((d,idx)=>{const row=document.createElement('div');row.className='d-flex align-items-center mb-2 day-row';row.dataset.idx=idx;row.innerHTML=`<span class='me-2 ${d.num===todayNum?'today-row':''}' style='width:2.5rem;'>${d.jp}</span>`;
  const sel=document.createElement('select');sel.id='sel'+d.id;sel.className='form-select form-select-sm';sel.style.maxWidth='160px';sel.innerHTML=`<option value='off'>ã‚ªãƒ•</option><option value='chest'>èƒ¸</option><option value='legs'>è¶³</option><option value='arms'>è…•</option><option value='back'>èƒŒä¸­</option>`;
  sel.addEventListener('change',()=>{if(editingDayIdx==idx) updateSectionVisibility(sel.value);savePlanState();});
  row.appendChild(sel);
  row.addEventListener('click',()=>setEditingDay(idx));
  wrap.appendChild(row);
});})();
// ====== Local Storage ======
function loadPlanState(){try{const obj=JSON.parse(localStorage.getItem(STORAGE_KEY_PLAN)||'null');if(obj&&obj.weekStart===currentWeek)return obj;}catch{}return {weekStart:currentWeek,dayCats:Array(7).fill('off'),setsByDay:Array(7).fill(null)};}
function savePlanState(){localStorage.setItem(STORAGE_KEY_PLAN,JSON.stringify(planState));}
let planState=loadPlanState();
// ====== Editing Day Handling ======
function setEditingDay(idx){editingDayIdx=idx;document.getElementById('liftCard').classList.remove('d-none');document.querySelectorAll('.day-row').forEach(r=>r.classList.toggle('editing-row',parseInt(r.dataset.idx)===idx));const sel=document.getElementById('sel'+DAYS[idx].id);document.getElementById('editDayLabel').innerText=`${DAYS[idx].jp} (${sel.options[sel.selectedIndex].text})`;updateSectionVisibility(sel.value);loadInputsFromState();}
function updateSectionVisibility(cat){['chest','legs','arms','back'].forEach(c=>document.getElementById('secWrap'+capitalize(c)).classList.toggle('d-none',c!==cat));}
function clearInputs(){Object.values(CATEGORY_EXERCISES).flat().forEach(ex=>{for(let i=1;i<=5;i++){document.getElementById(ex.prefix+'W'+i).value='';document.getElementById(ex.prefix+'R'+i).value='';}});}
function loadInputsFromState(){clearInputs();const setObj=planState.setsByDay[editingDayIdx]||{};Object.entries(setObj).forEach(([prefix,arr])=>{arr.forEach((s,i)=>{if(i<5){document.getElementById(prefix+'W'+(i+1)).value=s.w;document.getElementById(prefix+'R'+(i+1)).value=s.r;}});});}
function collectSets(prefix){const arr=[];for(let i=1;i<=5;i++){const w=parseFloat(document.getElementById(prefix+'W'+i).value);const r=parseInt(document.getElementById(prefix+'R'+i).value);if(!isNaN(w)&&!isNaN(r))arr.push({w,r});}return arr;}
function saveCurrentDayInputs(){if(editingDayIdx===null)return;const cat=document.getElementById('sel'+DAYS[editingDayIdx].id).value;if(cat==='off'){planState.setsByDay[editingDayIdx]=null;savePlanState();return;}const exList=CATEGORY_EXERCISES[cat];const obj={};exList.forEach(ex=>{const s=collectSets(ex.prefix);if(s.length)obj[ex.prefix]=s;});planState.setsByDay[editingDayIdx]=obj;savePlanState();}
// ====== History ======
function loadHistory(){try{return JSON.parse(localStorage.getItem(STORAGE_KEY_HIST)||'{}')}catch{return {}}}
function saveHistory(hist){localStorage.setItem(STORAGE_KEY_HIST,JSON.stringify(hist));}
function pushHistory(cat,rm){if(rm===null)return;const hist=loadHistory();if(!hist[cat])hist[cat]=[];hist[cat].push({date:new Date().toISOString().slice(0,10),rm:Math.round(rm)});saveHistory(hist);}
function calcSessionRM(exObj){let rms=[];Object.values(exObj).forEach(sets=>sets.forEach(s=>rms.push(estimate1RM(s.w,s.r))));if(!rms.length)return null;return rms.reduce((a,b)=>a+b)/rms.length;}
// ====== Plan Generator (uses stored inputs) ======
function generatePlan(){saveCurrentDayInputs(); // ensure latest edits saved
const dayCats=planState.dayCats; // updated via selectors
for(let i=0;i<7;i++){planState.dayCats[i]=document.getElementById('sel'+DAYS[i].id).value;}
savePlanState();
const progCount={chest:0,legs:0,arms:0,back:0};const plan={};const todayIdx=new Date().getDay();
for(let idx=0;idx<7;idx++){const cat=planState.dayCats[idx];if(cat==='off'||!planState.setsByDay[idx])continue;const exObj=planState.setsByDay[idx];const out={};Object.entries(exObj).forEach(([prefix,sets])=>{const exName=CATEGORY_EXERCISES[cat].find(e=>e.prefix===prefix).name;const modSets=sets.map(s=>{const estRM=estimate1RM(s.w,s.r);const newRM=estRM+2.5*progCount[cat];const newW=round05(newRM/(1+s.r/30));return `${newW}kg x ${s.r}`;});out[exName]=modSets;});plan[`Day ${idx+1} (${DAYS[idx].jp})`]=out;progCount[cat]++;if(idx===todayIdx){const rmAvg=calcSessionRM(exObj);pushHistory(cat,rmAvg);}}
if(!Object.keys(plan).length){alert('å…¥åŠ›ãŒä¸è¶³ã—ã¦ã„ã¾ã™');return;}renderPlan(plan);document.getElementById('planArea').classList.remove('d-none');}
// ====== Renderer ======
function renderPlan(obj){const area=document.getElementById('planDisplay');area.innerHTML='';Object.keys(obj).forEach(day=>{const card=document.createElement('div');card.className='card mb-3';card.innerHTML=`<div class='card-header fw-bold'>${day}</div>`;const list=document.createElement('ul');list.className='list-group list-group-flush';for(const ex in obj[day]){const li=document.createElement('li');li.className='list-group-item';li.innerHTML=`<strong>${ex}</strong>: ${obj[day][ex].join(', ')}`;list.appendChild(li);}card.appendChild(list);area.appendChild(card);});}
// ====== Stats ======
let currentCatIdx=0;function showStats(cat){const hist=loadHistory()[cat]||[];const labels=hist.map(h=>h.date);const vals=hist.map(h=>h.rm);document.getElementById('statsCatLabel').innerText=({chest:'èƒ¸',arms:'è…•',legs:'è¶³',back:'èƒŒä¸­'}[cat]);const ctx=document.getElementById('statsChart').getContext('2d');if(chartInstance)chartInstance.destroy();chartInstance=new Chart(ctx,{type:'line',data:{labels,datasets:[{label:'å¹³å‡1RM',data:vals}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:false}}}});}function switchPage(toStats){document.getElementById('pagePlanner').classList.toggle('d-none',toStats);document.getElementById('pageStats').classList.toggle('d-none',!toStats);document.getElementById('linkPlanner').classList.toggle('active',!toStats);document.getElementById('linkStats').classList.toggle('active',toStats);if(toStats)showStats(CATS[currentCatIdx]);}
// ====== Events ======
DAYS.forEach((d,idx)=>{document.getElementById('sel'+d.id).addEventListener('change',()=>{planState.dayCats[idx]=document.getElementById('sel'+d.id).value;savePlanState();if(editingDayIdx===idx)updateSectionVisibility(planState.dayCats[idx]);});});

document.getElementById('saveDayBtn').addEventListener('click',()=>{saveCurrentDayInputs();alert('ä¿å­˜ã—ã¾ã—ãŸ âœ”');});

// nav
